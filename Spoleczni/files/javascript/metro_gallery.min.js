/**
|------------------------------------------|
| MelonHTML5 - Metro Gallery               |
|------------------------------------------|
| @author:  Lee Le (lee@melonhtml5.com)    |
| @version: 1.12 (30 Aug 2014)             |
| @website: www.melonhtml5.com             |
|------------------------------------------|
*/

window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1E3/60)}}();
var Metro_Gallery={_containers:null,_tiles:null,_images:[],_image_pointer:0,_lightbox:null,_overlay:null,_loaded:!1,_configs:{base_size:100,gutter:10,scale:1.4,delay:1E3},_can_flip:!1,_use_css_animation:!0,_css3SupportDetect:function(){var a=document.body.style;if("string"==typeof a.transition)return Metro_Gallery._use_css_animation=!0;for(var c=["Webkit","Moz","Khtml","O","ms"],b=0;b<c.length;b++)if("string"==typeof a[c[b]+"Transition"])return Metro_Gallery._use_css_animation=!0;return Metro_Gallery._use_css_animation=
!1},_transitionEnd:function(a,c){Metro_Gallery._use_css_animation?(transEndEventNames="webkitTransitionEnd oTransitionEnd MSTransitionEnd transitionend",a.on(transEndEventNames,function(b){a.off(transEndEventNames);c(b,a)})):c(null,a);return a},_init:function(){Metro_Gallery._css3SupportDetect();$(document.body).addClass("loaded");Metro_Gallery._cache_elements();Metro_Gallery._buildStyles();Metro_Gallery._build()},_start:function(){if(!Metro_Gallery._loaded){var a=Metro_Gallery._configs.base_size+
Metro_Gallery._configs.gutter,c=Metro_Gallery._tiles.eq(0),b=c.attr("class").split(" ");$(b).each(function(b,e){if(-1!==e.indexOf("tile_")){var h=e.replace(/tile_/,"").substr(0,1),g=parseInt(c.css("margin-right"),10);a=(c.width()+2*g-2*g*h)/h+2*g;return!1}});Metro_Gallery._containers.each(function(){var b=$(this);b.hasClass("vertical")||b.hasClass("horizontal")||b.addClass("vertical");var c=new Masonry(b.get(0),{itemSelector:".tile",columnWidth:a,transitionDuration:"0.7s"});b.data("msnry",c)});Metro_Gallery._tiles.each(function(a){var b=
$(this);setTimeout(function(){if(Metro_Gallery._use_css_animation)Metro_Gallery._transitionEnd(b,function(a,b){b.removeClass("animating")}).addClass("animating loaded");else{var a=b.parents(".metro_gallery");a.hasClass("fade")||a.hasClass("flip")||a.hasClass("scale")?b.animate({opacity:1},200,"linear",function(){b.addClass("loaded")}):b.addClass("loaded")}},100*a);b.mouseenter(Metro_Gallery.Events.onMouseEnter).mouseleave(Metro_Gallery.Events.onMouseLeave)});Metro_Gallery._images.each(function(a){$(this).data("index",
a)});$(document).keyup(Metro_Gallery.Events.onKeyUp);if("undefined"!==typeof Hammer)try{Hammer(document.body,{swipe_velocity:.2}).on("swipeleft",Metro_Gallery.Events.onSwipeLeft),Hammer(document.body,{swipe_velocity:.2}).on("swiperight",Metro_Gallery.Events.onSwipeRight)}catch(e){}Metro_Gallery._can_flip&&setTimeout(function(){Metro_Gallery._startFlip()},100*(Metro_Gallery._tiles.length-1)+200);Metro_Gallery._loaded=!0}},_cache_elements:function(){this._tiles=$("div.tile");this._containers=$(".metro_gallery");
this._images=$("div.tile").children("img")},_buildStyles:function(){var a,c=(Metro_Gallery._configs.scale-1)*Metro_Gallery._configs.base_size;a="div.tile {"+("margin: "+Metro_Gallery._configs.gutter/2+"px;");a+="}";for(var b=1;10>=b;b++)for(y=1;10>=y;y++){var e=b*Metro_Gallery._configs.base_size+(b-1)*Metro_Gallery._configs.gutter,d=y*Metro_Gallery._configs.base_size+(y-1)*Metro_Gallery._configs.gutter;a+="div.tile_"+b+"x"+y+" {\r\n";a+="width: "+e+"px;\r\n";a+="height: "+d+"px;\r\n";a+="}\r\n";a+=
"div.tile_"+b+"x"+y+":hover {\r\n";a+="width: "+(e+c)+"px;\r\n";a+="height: "+d*(e+c)/e+"px;\r\n";a+="margin-top: "+(Metro_Gallery._configs.gutter/2-parseInt((d*(e+c)/e-d)/2,10))+"px;\r\n";a+="margin-left: "+(Metro_Gallery._configs.gutter/2-parseInt(c/2,10))+"px;\r\n";a+="}\r\n"}$('<style type="text/css">'+a+"</style>").appendTo($("head"))},_build:function(){Metro_Gallery._tiles.each(function(a){a=$(this);var c=a.parent(),b=a.children("img,div"),e=$("<div>").addClass("img_container"),d=$("<div>").addClass("scroller").append(b).appendTo(e),
f=$("<div>").addClass("caption");b.eq(0).data("caption")&&(b.eq(0).data("captionlink")?f.html('<a href="'+b.eq(0).data("captionlink")+'">'+b.eq(0).data("caption")+"</a>"):f.text(b.eq(0).data("caption")),a.addClass("caption"));c.hasClass("vertical")?(d.height(100*b.length+"%"),b.height(100/b.length+"%")):(d.width(100*b.length+"%"),b.width(100/b.length+"%"));a.data({active:1,num_images:b.length,caption:f,scroller:d}).append(e).append(f);b.click(Metro_Gallery.Events.imageClick);1<b.length&&(c=$("<a>").attr("href",
"#").addClass("prev").data("tile",a).click(Metro_Gallery.Events.prevClick),b=$("<a>").attr("href","#").addClass("next").data("tile",a).click(Metro_Gallery.Events.nextClick),a.append(c).append(b).data("prev",c).data("next",b),Metro_Gallery._can_flip=!0)})},_startFlip:function(){setInterval(function(){for(var a=!1,c=0;!a;){c++;if(10<=c)break;a=Metro_Gallery._tiles.eq(Math.floor(Math.random()*Metro_Gallery._tiles.length));if(1>=a.data("num_images")||a.data("hover"))a=!1}a&&a.data("next").click()},Metro_Gallery._configs.delay)},
_goNext:function(a,c){var b=a.parent(),e=a.data("scroller"),d=a.data("active"),f=a.data("num_images"),d="next"===c?d===f?1:d+1:1===d?f:d-1,h=e.children("img,div").eq(d-1);h.data("caption")?(h.data("captionlink")?a.data("caption").html('<a href="'+h.data("captionlink")+'">'+h.data("caption")+"</a>"):a.data("caption").text(h.data("caption")),a.addClass("caption"),a.data("caption").text(h.data("caption"))):(a.removeClass("caption"),a.data("caption").text(""));b=b.hasClass("vertical")?"top":"left";this._use_css_animation?
e.css(b,-100*(d-1)+"%"):"top"===b?e.animate({top:-100*(d-1)+"%"},200):e.animate({left:-100*(d-1)+"%"},200);a.data("active",d);"next"===c?(1<d?a.data("prev").show():a.data("prev").hide(),d===f?a.data("next").hide():a.data("next").show()):(1===d?a.data("prev").hide():a.data("prev").show(),d<f?a.data("next").show():a.data("next").hide())},_closeLightbox:function(a){Metro_Gallery._use_css_animation?(Metro_Gallery._overlay.removeClass("open"),Metro_Gallery._lightbox.addClass("close")):(Metro_Gallery._overlay.animate({opacity:0},
200),Metro_Gallery._lightbox.animate({opacity:0,top:"48%"},400));setTimeout(function(){Metro_Gallery._overlay.remove();Metro_Gallery._overlay=null},200);setTimeout(function(){Metro_Gallery._lightbox.remove();Metro_Gallery._lightbox=null},400)},_openLightbox:function(a){var c=a.parents("div.tile:first");c.parent();Metro_Gallery._overlay||(Metro_Gallery._overlay=$("<div>").addClass("metro_overlay").click(Metro_Gallery._closeLightbox).appendTo($(document.body)),Metro_Gallery._use_css_animation?requestAnimFrame(function(){Metro_Gallery._overlay.addClass("open")}):
Metro_Gallery._overlay.animate({opacity:.6},200,null,function(){Metro_Gallery._overlay.addClass("open")}));var b=a.data("iframe")?!0:!1;if(b){var e=a.data("iframe");e.indexOf("?")?a.data("iframe",e+"&wmode=opaque"):a.data("iframe",e+"?wmode=opaque")}var d=function(d,e){var g=Metro_Gallery._getLightboxSize(d,e),l={margin:"-"+g.height/2+"px 0px 0px -"+g.width/2+"px","border-color":c.css("background-color"),width:g.width,height:g.height},m=!1,k=!1;Metro_Gallery._lightbox?(Metro_Gallery._lightbox.children("iframe").remove(),
Metro_Gallery._lightbox.children("img").remove(),Metro_Gallery._lightbox.addClass("change"),Metro_Gallery._use_css_animation?Metro_Gallery._lightbox.css(l):Metro_Gallery._lightbox.animate(l,700),k=b?$("<iframe>").attr("src",a.data("iframe")).attr("width",Math.ceil(g.width)).attr("height",Math.ceil(g.height)).attr("frameborder","0").appendTo(Metro_Gallery._lightbox):$("<img>").attr("src",a.data("preview")?a.data("preview"):a.attr("src")).width(Math.ceil(g.width)).height(Math.ceil(g.height)).appendTo(Metro_Gallery._lightbox),
a.data("caption")?a.data("captionlink")?Metro_Gallery._lightbox.children("div.caption").html('<a href="'+a.data("captionlink")+'">'+a.data("caption")+"</a>").show():Metro_Gallery._lightbox.children("div.caption").text(a.data("caption")).show():Metro_Gallery._lightbox.children("div.caption").hide(),setTimeout(function(){Metro_Gallery._lightbox.removeClass("change");!Metro_Gallery._use_css_animation&&k&&(k.hide(),setTimeout(function(){k.fadeIn()},700))},200)):(m=!0,Metro_Gallery._lightbox=$("<div>").addClass("metro_lightbox").css(l),
k=b?$("<iframe>").attr("src",a.data("iframe")).attr("width",Math.ceil(g.width)).attr("height",Math.ceil(g.height)).attr("frameborder","0").appendTo(Metro_Gallery._lightbox):$("<img>").attr("src",a.data("preview")?a.data("preview"):a.attr("src")).width(Math.ceil(g.width)).height(Math.ceil(g.height)).appendTo(Metro_Gallery._lightbox),$("<a>").attr("href","#").addClass("prev").click(Metro_Gallery.Events.lightboxPrevClick).appendTo(Metro_Gallery._lightbox),$("<a>").attr("href","#").addClass("next").click(Metro_Gallery.Events.lightboxNextClick).appendTo(Metro_Gallery._lightbox),
a.data("caption")&&(a.data("captionlink")?$("<div>").addClass("caption").html('<a href="'+a.data("captionlink")+'">'+a.data("caption")+"</a>").appendTo(Metro_Gallery._lightbox):$("<div>").addClass("caption").text(a.data("caption")).appendTo(Metro_Gallery._lightbox)));m&&(Metro_Gallery._lightbox.appendTo($(document.body)),Metro_Gallery._use_css_animation?($(window).width(),requestAnimFrame(function(){Metro_Gallery._lightbox.addClass("open")})):Metro_Gallery._lightbox.animate({top:"50%"},700,null,function(){Metro_Gallery._lightbox.addClass("open")}))};
b?d(a.data("iframewidth"),a.data("iframeheight")):(e=new Image,e.src=a.data("preview")?a.data("preview"):a.attr("src"),e.complete?d(e.width,e.height):e.onload=function(){d(this.width,this.height)})},_getLightboxSize:function(a,c){var b=.8*$(window).width(),e=.8*$(window).height(),d=a,f=c;if(a>b||c>e)a>b&&c<=e?(d=b,f=c/(a/d)):c>e&&a<=b?(f=e,d=a/(c/f)):(d=b,f=c/(a/d),f>e&&(f=e,d=a/(c/f)));return{width:d,height:f}},setOptions:function(a){Metro_Gallery._configs.base_size="undefined"!==typeof a.base_size?
parseInt(a.base_size,10):Metro_Gallery._configs.base_size;Metro_Gallery._configs.gutter="undefined"!==typeof a.gutter?parseInt(a.gutter,10):Metro_Gallery._configs.gutter;Metro_Gallery._configs.scale="undefined"!==typeof a.scale?parseFloat(a.scale):Metro_Gallery._configs.scale;Metro_Gallery._configs.delay="undefined"!==typeof a.delay?parseInt(a.delay,10):Metro_Gallery._configs.delay},Events:{onMouseEnter:function(a){$(this).data("hover",!0)},onMouseLeave:function(a){$(this).data("hover",!1)},onKeyUp:function(a){if(Metro_Gallery._lightbox)switch(a.which){case 27:Metro_Gallery._closeLightbox(a);
break;case 37:Metro_Gallery.Events.lightboxPrevClick(a);break;case 39:Metro_Gallery.Events.lightboxNextClick(a)}},prevClick:function(a){a.preventDefault();a.stopPropagation();Metro_Gallery._goNext($(this).data("tile"),"back")},nextClick:function(a){a.preventDefault();a.stopPropagation();Metro_Gallery._goNext($(this).data("tile"),"next")},lightboxPrevClick:function(a){a&&(a.preventDefault(),a.stopPropagation());0===Metro_Gallery._image_pointer?Metro_Gallery._image_pointer=Metro_Gallery._images.length-
1:Metro_Gallery._image_pointer--;Metro_Gallery._images.eq(Metro_Gallery._image_pointer).click()},lightboxNextClick:function(a){a&&(a.preventDefault(),a.stopPropagation());Metro_Gallery._image_pointer===Metro_Gallery._images.length-1?Metro_Gallery._image_pointer=0:Metro_Gallery._image_pointer++;Metro_Gallery._images.eq(Metro_Gallery._image_pointer).click()},imageClick:function(a){a.stopPropagation();var c=$(this);a=c.data("link");"img"===c.prop("tagName").toLowerCase()&&(a?window.open(a,"_blank"):
c.parents(".metro_gallery").hasClass("lightbox")&&(Metro_Gallery._images.each(function(a){if($(this).get(0)===c.get(0))return Metro_Gallery._image_pointer=a,!1}),Metro_Gallery._openLightbox(c)))},onSwipeLeft:function(a){Metro_Gallery._overlay&&Metro_Gallery._lightbox&&Metro_Gallery.Events.lightboxPrevClick()},onSwipeRight:function(a){Metro_Gallery._overlay&&Metro_Gallery._lightbox&&Metro_Gallery.Events.lightboxNextClick()}}};$(document).ready(Metro_Gallery._init);setTimeout(Metro_Gallery._start,5E3);
$(window).load(Metro_Gallery._start);